local KEY = "MySecretKey123"
local PATH = "/sdcard/Documents/MuMuSharedFolder/Movies/license.bin"

local function xorDecrypt(data, key)
    local out = {}
    for i = 1, #data do
        local k = key:byte(((i - 1) % #key) + 1)
        out[i] = string.char(bit32.bxor(data:byte(i), k))
    end
    return table.concat(out)
end

local function parseTime(str)
    local y, m, d, h, mi, s = str:match("(%d+)%-(%d+)%-(%d+) (%d+):(%d+):(%d+)")
    if not y then return nil end
    return os.time({
        year = tonumber(y),
        month = tonumber(m),
        day = tonumber(d),
        hour = tonumber(h),
        min = tonumber(mi),
        sec = tonumber(s)
    })
end

local f = io.open(PATH, "rb")
if not f then
    gg.alert("License file not found")
    os.exit()
end

local enc = f:read("*all")
f:close()

local text = xorDecrypt(enc, KEY)
local _, timeStr = text:match("([^|]+)|(.+)")
if not timeStr then
    gg.alert("Invalid license")
    os.exit()
end

local licenseTime = parseTime(timeStr)
if not licenseTime then
    gg.alert("Invalid time format")
    os.exit()
end

local now = os.time()
local maxAge = 30 * 24 * 60 * 60

if now - licenseTime > maxAge then
    gg.alert("License expired")
    os.exit()
end

gg.toast("License valid")
